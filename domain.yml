version: "3.1"

# 1. INTENTS: Lista de todas las intenciones que el bot debe reconocer.
# Deben coincidir exactamente con las de nlu.yml.
intents:
  - greet
  - goodbye
  - affirm
  - deny
  - bot_challenge
  - iniciar_test
  - admitir_problema
  - negar_problema
  - expresar_sentimiento_negativo
  - expresar_impacto_vida
  - reportar_tiempo_uso
  - pedir_recomendaciones

entities:
  - red_social
  - sentimiento
  - duracion_relativa # <-- CAMBIO: Actualizamos la entidad
  - frecuencia        # <-- CAMBIO: Actualizamos la entidad

# domain.yml

slots:
  # Slot para guardar la red social que mÃ¡s usa el usuario (para personalizar mensajes)
  red_social:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: red_social

  # Slot para guardar la puntuaciÃ³n final del test
  puntuacion_diagnostico:
    type: float
    initial_value: 0.0
    influence_conversation: false
    mappings:
      - type: custom

  respuesta_preocupacion:
    type: any # Cambiamos a 'any' para tener mÃ¡s control
    mappings:
      - type: from_text
        conditions:
          - active_loop: diagnostic_form
            requested_slot: respuesta_preocupacion

  respuesta_tolerancia:
    type: any
    mappings:
      - type: from_text
        conditions:
          - active_loop: diagnostic_form
            requested_slot: respuesta_tolerancia

  respuesta_abstinencia:
    type: any
    mappings:
      - type: from_text
        conditions:
          - active_loop: diagnostic_form
            requested_slot: respuesta_abstinencia

  respuesta_conflicto:
    type: any
    mappings:
      - type: from_text
        conditions:
          - active_loop: diagnostic_form
            requested_slot: respuesta_conflicto
  # ... (AquÃ­ puedes agregar los slots sin duckling si los creaste)
  duracion_reportada:
    type: text
    influence_conversation: false
    mappings:
    - type: from_entity
      entity: duracion_relativa

# 4. RESPONSES: Lo que el bot puede decir.
responses:
  # Respuestas bÃ¡sicas
  utter_greet:
    - text: "Â¡Hola! Soy tu asistente para evaluar el uso de redes sociales. Â¿Te gustarÃ­a comenzar el test para entender mejor tus hÃ¡bitos?"

  utter_goodbye:
    - text: "Â¡Hasta luego! Recuerda que tomar conciencia es el primer paso. Â¡CuÃ­date!"

  utter_iamabot:
    - text: "Soy un bot creado con Rasa, diseÃ±ado para ayudarte a reflexionar sobre tu uso de las redes sociales."

  utter_please_rephrase:
    - text: "No te he entendido muy bien, Â¿podrÃ­as decÃ­rmelo de otra forma?"

  # Respuestas para el flujo del test
  utter_empecemos_test:
    - text: "Â¡Perfecto! Te harÃ© 4 preguntas clave. Por favor, responde con sinceridad (un 'sÃ­' o un 'no' es suficiente)."

  # Preguntas del formulario de diagnÃ³stico (basadas en criterios de adicciÃ³n)
  utter_ask_respuesta_preocupacion:
    - text: "1. Â¿Piensas en las redes sociales o sientes la necesidad de usarlas durante gran parte del dÃ­a?"

  utter_ask_respuesta_tolerancia:
    - text: "2. Â¿Sientes que necesitas pasar cada vez mÃ¡s tiempo en las redes sociales para sentirte satisfecho?"

  utter_ask_respuesta_abstinencia:
    - text: "3. Â¿Te sientes inquieto, irritable o ansioso cuando no puedes usar las redes sociales?"

  utter_ask_respuesta_conflicto:
    - text: "4. Â¿El uso que haces de las redes sociales ha causado problemas en tu trabajo, estudios o relaciones personales?"

  # Respuestas de empatÃ­a
  utter_gracias_por_compartir:
    - text: "Gracias por compartir eso conmigo. Es valiente reconocerlo."

  utter_ask_recomendaciones:
    - text: "Â¿Te gustarÃ­a recibir algunas recomendaciones prÃ¡cticas para manejar mejor tu tiempo en redes sociales?"

    # Mantenemos las respuestas de recomendaciones
  utter_recomendaciones_generales:
    - text: "Â¡Claro! AquÃ­ tienes algunas recomendaciones que han ayudado a muchas personas:"

  utter_diagnostico_moderado:
    - text: "Gracias. Tus respuestas sugieren que podrÃ­as estar en riesgo de desarrollar un hÃ¡bito problemÃ¡tico. Es un buen momento para tomar algunas medidas preventivas."

  utter_diagnostico_alto:
    - text: "Entiendo. SegÃºn tus respuestas, tu relaciÃ³n con las redes sociales parece ser problemÃ¡tica y estÃ¡ afectando tu bienestar. Es importante que tomes acciÃ³n. Considera hablar con un amigo, familiar o un profesional de la salud mental sobre esto."

    # --- NUEVAS RESPUESTAS DE RECOMENDACIONES ---

  utter_recomendacion_notificaciones:
    - text: "ðŸ“µ **Desactiva las notificaciones:** Ve a la configuraciÃ³n de tu telÃ©fono y desactiva todas las notificaciones no esenciales de apps como Instagram, TikTok o Facebook. Esto elimina el impulso constante de revisar tu mÃ³vil."

  utter_recomendacion_horarios:
    - text: "â° **Establece horarios definidos:** Designa bloques de tiempo especÃ­ficos para usar redes sociales (ej. 30 minutos despuÃ©s de almorzar) y mantÃ©n el mÃ³vil fuera de tu vista el resto del tiempo."

  utter_recomendacion_zonas_libres:
    - text: "ðŸ  **Crea zonas libres de mÃ³vil:** Decide que ciertas Ã¡reas, como tu dormitorio o la mesa donde comes, son zonas donde no se usa el mÃ³vil. Esto mejora el sueÃ±o y la interacciÃ³n social."

  utter_recomendacion_hobbies:
    - text: "ðŸŽ¨ **Reemplaza el hÃ¡bito:** Busca actividades que disfrutes y que no involucren una pantalla. Leer un libro, salir a caminar, practicar un deporte o aprender algo nuevo pueden llenar el vacÃ­o que deja el scrolling."

  utter_diagnostico_final_ayuda:
    - text: "Recuerda que tomar el control es un proceso. Â¡PequeÃ±os cambios pueden hacer una gran diferencia!"

# 5. ACTIONS: Lista de todas las acciones que el bot puede realizar.
# Incluye las respuestas (utter_) y las acciones personalizadas (custom actions).
actions:
  - action_calcular_diagnostico # AcciÃ³n personalizada que crearemos en actions.py
  - action_dar_recomendaciones

# 6. FORMS: DefiniciÃ³n de los formularios para recopilar datos.
forms:
  diagnostic_form:
    # Lista de slots que el formulario debe rellenar
    required_slots:
      - respuesta_preocupacion
      - respuesta_tolerancia
      - respuesta_abstinencia
      - respuesta_conflicto

# 7. SESSION CONFIG: CÃ³mo se manejan las sesiones de conversaciÃ³n.
session_config:
  session_expiration_time: 60  # La sesiÃ³n termina despuÃ©s de 60 minutos de inactividad
  carry_over_slots_to_new_session: true # Mantiene los slots si la sesiÃ³n expira y el usuario vuelve